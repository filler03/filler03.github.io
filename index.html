<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Hen & Eggs Game</title>
<style>
/* 
===========================================
   GAME CONFIGURATION VARIABLES (CSS)
===========================================
   These are defaults; you can edit them in the UI.
   - --chicken-size: Size of the chicken emoji (px)
   - --egg-width / --egg-height: Egg dimensions (px)
   - --speed: Chicken glide speed (e.g., 0.02 ‚Äì 0.5)
   - --egg-min-distance: Minimum distance (px) to lay a new egg
   - --chick-size: Size of the chick emoji (px)
   - --chick-speed: How fast chicks walk (px per frame)
===========================================
*/
:root {
  --chicken-size: 90px;
  --egg-width: 28px;
  --egg-height: 36px;
  --speed: 0.08;      /* Lower = slower glide */
  --egg-min-distance: 100px;
  --chick-size: 50px;
  --chick-speed: 1.5;
}

/* ===========================================
   BASIC STYLES
=========================================== */
html, body {
  margin: 0;
  height: 100%;
  background: #a7d289;
  overflow: hidden;
  font-family: system-ui, sans-serif;
}

#game-area {
  position: relative;
  width: 100vw;
  height: 100vh;
}

/* HUD */
#hud {
  position: absolute;
  top: 8px;
  left: 10px;
  color: #17310c;
  background: rgba(255,255,255,0.75);
  padding: 6px 10px;
  border-radius: 8px;
  font-size: 14px;
  user-select: none;
  z-index: 10;
}

/* SETTINGS PANEL (freeform editable fields) */
#controls {
  position: absolute;
  top: 8px;
  right: 10px;
  width: 320px;
  background: rgba(255,255,255,0.92);
  border-radius: 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  padding: 12px 14px;
  font-size: 14px;
  color: #17310c;
  z-index: 10;
  /* CHANGE: Hide the settings panel */
  display: none; 
}
#controls h3 {
  margin: 6px 0 10px;
  font-size: 16px;
}
.field {
  margin: 10px 0;
}
.field label {
  display: block;
  font-weight: 600;
  margin-bottom: 4px;
}
.field input[type="number"],
.field input[type="text"] {
  width: 100%;
  padding: 6px 8px;
  border: 1px solid #c7d8bb;
  border-radius: 6px;
  font-size: 14px;
  box-sizing: border-box;
}
.hint {
  font-size: 12px;
  color: #3c5a2a;
  margin-top: 2px;
}
#buttons {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}
button {
  background: #2f6b1d;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  cursor: pointer;
}
button.secondary {
  background: #5b8e3a;
}

/* CHICKEN & EGG */
.chicken {
  position: absolute;
  width: var(--chicken-size);
  height: var(--chicken-size);
  font-size: var(--chicken-size);
  line-height: var(--chicken-size);
  text-align: center;
  transform-origin: center;
  transition: transform 80ms ease-out;
}

.egg {
  position: absolute;
  width: var(--egg-width);
  height: var(--egg-height);
  font-size: var(--egg-height);
  text-align: center;
  cursor: pointer;
  transition: transform 0.1s ease;
}

.egg:hover {
  transform: scale(1.1);
}

.egg.hatching {
  animation: shake 0.3s ease-in-out infinite;
}

@keyframes shake {
  0%, 100% { transform: translateX(0) rotate(0deg); }
  25% { transform: translateX(-3px) rotate(-5deg); }
  75% { transform: translateX(3px) rotate(5deg); }
}

.chick {
  position: absolute;
  width: var(--chick-size);
  height: var(--chick-size);
  font-size: var(--chick-size);
  line-height: var(--chick-size);
  text-align: center;
  transform-origin: center;
}
</style>
</head>
<body>
<div id="game-area">
  <div id="hud">Move your mouse. Press Space to lay an egg. Click eggs to hatch them!</div>

  <!-- Settings panel (freeform fields) -->
  <div id="controls" aria-label="Game settings">
    <h3>Game Settings</h3>

    <div class="field">
      <label for="chickenSizeInput">Chicken Size (px)</label>
      <input id="chickenSizeInput" type="number" inputmode="numeric" placeholder="e.g. 90">
      <div class="hint">Controls the chicken emoji size.</div>
    </div>

    <div class="field">
      <label for="eggWidthInput">Egg Width (px)</label>
      <input id="eggWidthInput" type="number" inputmode="numeric" placeholder="e.g. 28">
      <div class="hint">Horizontal size of the egg.</div>
    </div>

    <div class="field">
      <label for="eggHeightInput">Egg Height (px)</label>
      <input id="eggHeightInput" type="number" inputmode="numeric" placeholder="e.g. 36">
      <div class="hint">Vertical size and font size of the egg.</div>
    </div>

    <div class="field">
      <label for="speedInput">Glide Speed (decimal)</label>
      <input id="speedInput" type="text" inputmode="decimal" placeholder="e.g. 0.08">
      <div class="hint">Recommended range 0.02‚Äì0.50. Higher = faster.</div>
    </div>

    <div class="field">
      <label for="eggMinDistanceInput">Egg Min Distance (px)</label>
      <input id="eggMinDistanceInput" type="number" inputmode="numeric" placeholder="e.g. 100">
      <div class="hint">Minimum distance from existing eggs required to lay a new egg.</div>
    </div>

    <div class="field">
      <label for="chickSizeInput">Chick Size (px)</label>
      <input id="chickSizeInput" type="number" inputmode="numeric" placeholder="e.g. 50">
      <div class="hint">Size of hatched chicks.</div>
    </div>

    <div class="field">
      <label for="chickSpeedInput">Chick Speed (decimal)</label>
      <input id="chickSpeedInput" type="text" inputmode="decimal" placeholder="e.g. 1.5">
      <div class="hint">How fast chicks walk around.</div>
    </div>

    <div id="buttons">
      <button id="resetBtn" class="secondary" title="Reset to defaults">Reset</button>
      <button id="clearEggsBtn" title="Remove all eggs">Clear Eggs</button>
    </div>
  </div>
</div>

<script>
/** Utility: CSS var helpers */
function getCSSRaw(varName) {
  return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
}
function getCSSNumber(varName) {
  const raw = getCSSRaw(varName);
  return raw.endsWith('px') ? parseFloat(raw) : parseFloat(raw);
}
function setCSSVar(varName, value, unit = '') {
  const v = unit ? `${value}${unit}` : `${value}`;
  document.documentElement.style.setProperty(varName, v);
}

/** Game classes */
class Chicken {
  constructor(gameArea) {
    this.gameArea = gameArea;
    this.element = document.createElement('div');
    this.element.className = 'chicken';
    this.element.textContent = 'üêì';
    this.gameArea.appendChild(this.element);

    // center start
    this.x = (gameArea.clientWidth - this.element.offsetWidth) / 2;
    this.y = (gameArea.clientHeight - this.element.offsetHeight) / 2;
    this.targetX = this.x;
    this.targetY = this.y;
    this.facing = 1; // 1 = right, -1 = left

    this.render();
    this.animate();
  }

  moveTo(mouseX, mouseY) {
    const rect = this.gameArea.getBoundingClientRect();
    const maxX = this.gameArea.clientWidth - this.element.offsetWidth;
    const maxY = this.gameArea.clientHeight - this.element.offsetHeight;

    // Mouse coords relative to game area
    const gx = mouseX - rect.left;
    const gy = mouseY - rect.top;

    this.targetX = Math.max(0, Math.min(maxX, gx - this.element.offsetWidth / 2));
    this.targetY = Math.max(0, Math.min(maxY, gy - this.element.offsetHeight / 2));
  }

  animate() {
    // Read speed dynamically so settings updates apply immediately
    const speed = parseFloat(getCSSRaw('--speed'));

    const dx = this.targetX - this.x;
    const dy = this.targetY - this.y;

    // Update facing based on horizontal movement direction
    if (Math.abs(dx) > 0.5) {
      this.facing = dx >= 0 ? 1 : -1;
    }

    this.x += dx * speed;
    this.y += dy * speed;

    this.render();
    requestAnimationFrame(() => this.animate());
  }

  clampToBounds() {
    const maxX = this.gameArea.clientWidth - this.element.offsetWidth;
    const maxY = this.gameArea.clientHeight - this.element.offsetHeight;
    this.x = Math.max(0, Math.min(maxX, this.x));
    this.y = Math.max(0, Math.min(maxY, this.y));
    this.targetX = Math.max(0, Math.min(maxX, this.targetX));
    this.targetY = Math.max(0, Math.min(maxY, this.targetY));
  }

  render() {
    this.element.style.left = `${this.x}px`;
    this.element.style.top = `${this.y}px`;
    // Flip the chicken emoji based on direction
    this.element.style.transform = `scaleX(${this.facing})`;
  }
}

class Egg {
  constructor(gameArea, x, y, onHatch) {
    this.gameArea = gameArea;
    this.onHatch = onHatch;
    this.element = document.createElement('div');
    this.element.className = 'egg';
    this.element.textContent = 'ü•ö';
    this.element.style.left = `${x}px`;
    this.element.style.top = `${y}px`;
    this.gameArea.appendChild(this.element);

    this.element.addEventListener('click', () => this.startHatching());

    this.isHatching = false;
    this.hatchTimer = null;
  }

  startHatching() {
    if (this.isHatching) return;
    this.isHatching = true;
    this.element.classList.add('hatching');
    this.hatchTimer = setTimeout(() => this.hatch(), 1500); // Hatch after 1.5 seconds
  }

  hatch() {
    clearTimeout(this.hatchTimer);
    this.element.remove();
    this.onHatch(this.x, this.y);
  }

  get x() { return parseFloat(this.element.style.left); }
  get y() { return parseFloat(this.element.style.top); }
  get width() { return this.element.offsetWidth; }
  get height() { return this.element.offsetHeight; }
}

class Chick {
  constructor(gameArea, x, y) {
    this.gameArea = gameArea;
    this.element = document.createElement('div');
    this.element.className = 'chick';
    this.element.textContent = 'üê•';
    this.gameArea.appendChild(this.element);

    this.x = x + getCSSNumber('--egg-width') / 2 - getCSSNumber('--chick-size') / 2;
    this.y = y + getCSSNumber('--egg-height') / 2 - getCSSNumber('--chick-size') / 2;
    this.facing = Math.random() < 0.5 ? 1 : -1;

    this.setNewTarget();
    this.animate();
  }

  setNewTarget() {
    const maxX = this.gameArea.clientWidth - this.element.offsetWidth;
    const maxY = this.gameArea.clientHeight - this.element.offsetHeight;
    this.targetX = Math.random() * maxX;
    this.targetY = Math.random() * maxY;
  }

  animate() {
    const speed = parseFloat(getCSSRaw('--chick-speed')); // Read speed dynamically

    const dx = this.targetX - this.x;
    const dy = this.targetY - this.y;
    const distance = Math.sqrt(dx * dx + dy * dy);

    if (distance < 5) {
      this.setNewTarget();
    } else {
      this.x += (dx / distance) * speed;
      this.y += (dy / distance) * speed;

      // Update facing based on horizontal movement direction
      if (Math.abs(dx) > 0.5) {
        this.facing = dx >= 0 ? 1 : -1;
      }
    }

    this.render();
    requestAnimationFrame(() => this.animate());
  }

  render() {
    this.element.style.left = `${this.x}px`;
    this.element.style.top = `${this.y}px`;
    this.element.style.transform = `scaleX(${this.facing})`;
  }
}


/** Main Game Logic */
const gameArea = document.getElementById('game-area');
const chicken = new Chicken(gameArea);
let eggs = [];
let chicks = [];
let lastEggTime = 0;
const EGG_COOLDOWN = 300; // milliseconds

function handleHatch(x, y) {
  // Filter out the hatched egg
  eggs = eggs.filter(egg => egg.x !== x || egg.y !== y);
  // Create a new chick
  chicks.push(new Chick(gameArea, x, y));
}

function layEgg() {
  const now = Date.now();
  if (now - lastEggTime < EGG_COOLDOWN) return;

  // Read min distance dynamically
  const minDistance = getCSSNumber('--egg-min-distance');

  const x = chicken.x + chicken.element.offsetWidth / 2 - getCSSNumber('--egg-width') / 2;
  const y = chicken.y + chicken.element.offsetHeight / 2 - getCSSNumber('--egg-height') / 2;

  // Check distance to all existing eggs
  for (const egg of eggs) {
    const dx = egg.x - x;
    const dy = egg.y - y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    if (distance < minDistance) {
      return; // Too close to another egg, don't lay
    }
  }

  eggs.push(new Egg(gameArea, x, y, handleHatch));
  lastEggTime = now;
}

// Event listeners
gameArea.addEventListener('mousemove', (e) => {
  chicken.moveTo(e.clientX, e.clientY);
});

document.addEventListener('keydown', (e) => {
  if (e.code === 'Space') {
    e.preventDefault(); // Prevent scrolling
    layEgg();
  }
});

// Update chicken position when window resizes (to stay on screen)
window.addEventListener('resize', () => {
  chicken.clampToBounds();
});


/* 
===========================================
   SETTINGS UI LOGIC (now inactive/hidden)
=========================================== 
*/

/* This JS logic is now redundant as the UI is hidden, but can remain if needed later */

const defaultSettings = {
  '--chicken-size': getCSSRaw('--chicken-size'),
  '--egg-width': getCSSRaw('--egg-width'),
  '--egg-height': getCSSRaw('--egg-height'),
  '--speed': getCSSRaw('--speed'),
  '--egg-min-distance': getCSSRaw('--egg-min-distance'),
  '--chick-size': getCSSRaw('--chick-size'),
  '--chick-speed': getCSSRaw('--chick-speed'),
};

function updateCSSVarFromInput(inputElement, varName, unit = '') {
  inputElement.addEventListener('input', (e) => {
    let value = e.target.value;
    // Basic validation for numbers
    if (inputElement.type === 'number' && value !== '') {
        value = parseFloat(value);
    } else if (inputElement.inputmode === 'decimal' && value !== '') {
        value = parseFloat(value);
    }

    if (!isNaN(value) && value !== '') {
      setCSSVar(varName, value, unit);
    }
  });
}

function loadSettings() {
  document.getElementById('chickenSizeInput').value = getCSSNumber('--chicken-size');
  document.getElementById('eggWidthInput').value = getCSSNumber('--egg-width');
  document.getElementById('eggHeightInput').value = getCSSNumber('--egg-height');
  document.getElementById('speedInput').value = getCSSRaw('--speed');
  document.getElementById('eggMinDistanceInput').value = getCSSNumber('--egg-min-distance');
  document.getElementById('chickSizeInput').value = getCSSNumber('--chick-size');
  document.getElementById('chickSpeedInput').value = getCSSRaw('--chick-speed');
}

function resetSettings() {
  for (const [varName, defaultValue] of Object.entries(defaultSettings)) {
    document.documentElement.style.setProperty(varName, defaultValue);
  }
  loadSettings();
}

function clearEggs() {
  eggs.forEach(egg => egg.element.remove());
  eggs = [];
}

// Initialize settings inputs with current values
// loadSettings(); 

// Hook up event listeners for inputs
// updateCSSVarFromInput(document.getElementById('chickenSizeInput'), '--chicken-size', 'px');
// updateCSSVarFromInput(document.getElementById('eggWidthInput'), '--egg-width', 'px');
// updateCSSVarFromInput(document.getElementById('eggHeightInput'), '--egg-height', 'px');
// updateCSSVarFromInput(document.getElementById('speedInput'), '--speed');
// updateCSSVarFromInput(document.getElementById('eggMinDistanceInput'), '--egg-min-distance', 'px');
// updateCSSVarFromInput(document.getElementById('chickSizeInput'), '--chick-size', 'px');
// updateCSSVarFromInput(document.getElementById('chickSpeedInput'), '--chick-speed');

// Hook up buttons
// document.getElementById('resetBtn').addEventListener('click', resetSettings);
// document.getElementById('clearEggsBtn').addEventListener('click', clearEggs);

</script>
</body>
</html>
